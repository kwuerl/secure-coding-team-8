\subsection{Testing for Account Enumeration and Guessable User Account - OTG-IDENT-004} \label{OTG-IDENT-004}
\begin{longtable}[l]{ p{2.3cm} | p{.79\linewidth} }\hline
    & \textbf{InternetBanking}
    \hfill CVSS Score: 6.5 \progressbar[filledcolor=BurntOrange]{0.65}
    \\ \hline
    \textbf{Observation} & It was found that the application responds with the same error messages for every client request that produces a failed authentication. This has been tested in the Login page. \\
    \textbf{Discovery} &
         This test was performed manually by trying various combinations of email and password. Steps are as follows:
            \begin{itemize}
                \item \textbf{Scenario 1 -} Testing for Valid user with right password
                    \begin{itemize}
                        \item Open the Login page and enter a valid email and password. Click on the Submit button.
                        \item The user is redirected to the Transactions page without any success message.
                    \end{itemize}
                 \item \textbf{Scenario 2 -} Testing for Valid user with wrong password
                    \begin{itemize}
                        \item Open the Login page and enter a valid email with an incorrect password. Click on the Submit button.
                        \item An error message is displayed that reads \code{ Login and/or password not correct.}, and the user stays on Login page. Also, the data entered in the form is cleared off.
                    \end{itemize}
                \end{itemize}
                    \\ &
                \begin{itemize}
                \item \textbf{Scenario 3-} Testing for non-existent User
                   \begin{itemize}
                        \item Open the Login page and enter an incorrect email and password. Click on the Submit button.
                        \item An error message is displayed that reads \code{
                   Login and/or password not correct.}, and the user stays on Login page. Also, the data entered in the form is cleared off.
                   \end{itemize}
                \item \textbf{Scenario 4-} Registering a new User
                   \begin{itemize}
                        \item Open the Registration page and enter thr details. Click on the Submit button.
                        \item An error message is displayed that reads \code{Username already in use, please choose another} or \code{Email-id is already in use, please choose another.} and the user stays on the same page. Refer \ref{code:user_check} for the related code excerpt.
                   \end{itemize}
            \end{itemize}
    \\
    \textbf{Likelihood} & Likelihood is low as some skills are required to perform dictionary attcks or to use password-cracking softwares and the time to guess a valid user. \\
    \textbf{Impact} & Impact is high because if a user account is hacked, all permitted operations can be performed. \\
    \textbf{Recommen\-dations} & It is recommended to have consistent messages on failed attempts. Also, a lockout mechanism should be implemented. \\ \hline
    \textbf{CVSS} &
        \begin{tabular}[t]{@{}l | l}
            Attack Vector           & \textcolor{red}{Network} \\
            Attack Complexity       & \textcolor{Green}{High} \\
            Privileges Required     & \textcolor{red}{None} \\
            User Interaction        & \textcolor{red}{None} \\
            Scope                   & \textcolor{Green}{Unchanged} \\
            Confidentiality Impact  & \textcolor{red}{High} \\
            Integrity Impact        & \textcolor{BurntOrange}{Low} \\
            Availability Impact     & \textcolor{Green}{None}
        \end{tabular}
    \\ \hline
\end{longtable}

\begin{longtable}[l]{ p{2.3cm} | p{.79\linewidth} }\hline
    & \textbf{SecureBank} \\ \hline
    \textbf{Observation} & It was found that the application responds with different error messages for different incorrect login requests. However, it is not possible to enumerate users. There is also a lockout mechanism which locks the account after 5 failed login attempts.\\
    \textbf{Discovery} &
        This test was performed manually by trying various combinations of email and password. Steps are as follows:
            \begin{itemize}
                \item \textbf{Scenario 1 -} Testing for Valid user with right password
                    \begin{itemize}
                         \item Open the Login page and enter a valid email and password. Click on the Submit button.
                         \item The user is redirected to the Home page without any success message.
                    \end{itemize}
                 \item \textbf{Scenario 2 -} Testing for Valid user with wrong password
                    \begin{itemize}
                      \item Open the Login page and enter a valid email with an incorrect password. Click on the Submit button.
                      \item An error message is displayed that reads \code{Login failed - Either the e-mail or the password is wrong.}, and the user stays on Login page. Also, the data entered in the form is retained.
                    \end{itemize}
                \item \textbf{Scenario 3-} Testing for non-existent User
                   \begin{itemize}
                       \item Open the Login page and enter an incorrect email and password. Click on the Submit button.
                       \item An error message is displayed that reads \code{Login failed - There is no account with this email.}, and the user stays on Login page. Also, the data entered in the form is retained.
                   \end{itemize}
            \end{itemize}
    \\
    \textbf{Likelihood} & N/A \\
    \textbf{Impact} & N/A \\
    \textbf{Recommen\-dations} & It is recommended to have consistent messages on failed attempts. \\ \hline
    \textbf{CVSS} & N/A
    \\ \hline
\end{longtable}

\subsubsection{Comparison}
In InternetBanking, it is possible to enumerate usernames and is hence vulnerable, also owing to the non-existent lockout mechanism.
In case of SecureBank, though the error messages differ, no vulnerability has been detected owing to the absence of username-baseed login and the presence of a lockout mechanism.
Hence, SecureBank is more vulnerable than InternetBanking.
\clearpage

\begin{lstlisting}[caption={PHP code for checking user from registrationController.php}\label{code:user_check}, language=PHP, basicstyle=\footnotesize, frame=single, captionpos=t, linewidth=.9\textwidth, xleftmargin=.12\textwidth]
	$user = $db->checkUsername($_POST['username']);

	if($user!=NULL){
		$error .= 'Username already in use, please choose another.<br>';
	}
	if(!filter_var($email,FILTER_VALIDATE_EMAIL)){
		$error .= 'Email is invalid<br>';
	}
	else{
		$user = $db->checkEmail($_POST['email']);
		if($user!=NULL){
			$error .= 'Email-id is already in use,
			please choose another.<br>';
		}
	}
\end{lstlisting}